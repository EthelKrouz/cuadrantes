document.addEventListener("DOMContentLoaded",function(){var t,n=document.querySelectorAll(".quadrant"),o=document.getElementById("name-modal"),e=o.querySelector(".close-name-modal-button"),a=document.getElementById("save-name-button"),i=document.getElementById("name-input"),s=document.getElementById("name-list"),l=document.getElementById("modal-title"),d=document.getElementById("confirm-modal"),r=document.getElementById("cancel-delete-button"),c=document.getElementById("accept-delete-button"),u=document.getElementById("name-to-delete"),m=document.getElementById("open-circle-modal-button"),y=document.getElementById("circle-modal"),p=document.querySelector(".close-circle-modal-button"),f=document.getElementById("new-circle-container"),v=document.getElementById("loading-spinner"),b=document.getElementById("download-button"),g=document.getElementById("progress-container"),h=document.getElementById("progress-bar"),w=document.getElementById("download-message"),x="",L={quadrant:null,docId:null,name:null},E=!1,F=!1,q={},I=!1,k={"top-left":{title:'Nombres para Cuadrante Azul: <span class="subtitulo-azul">Formales, Precisos, Precavidos, Deliberado, Cuestionado.</span>'},"top-right":{title:'Nombres para Cuadrante Rojo: <span class="subtitulo-rojo">Propositivo, Competitivo, Demandante, Determinado.</span>'},"bottom-left":{title:'Nombres para Cuadrante Amarillo: <span class="subtitulo-amarillo">Comprensivo, Compartido, Alentador, Relajado, Paciente.</span>'},"bottom-right":{title:'Nombres para Cuadrante Verde: <span class="subtitulo-verde">Dinámico, Persuasivo, Entusiasta, Expresivo, Sociable.</span>'}};function C(e,n,a,o,i){return new Promise(function(t){if(E)return e.style.transform=n,e.style.zIndex="1",void setTimeout(t,i);e.style.transition="transform "+o+"ms cubic-bezier(0.68, -0.55, 0.27, 1.55)",e.style.zIndex="10",e.style.transform=a,setTimeout(function(){E||(e.style.transition="transform "+o+"ms cubic-bezier(0.68, -0.55, 0.27, 1.55)",e.style.zIndex="1",e.style.transform=n),setTimeout(t,i)},o)})}async function B(){for(;!(E||(await C(document.querySelector(".top-left"),"translate(-5px, -5px)","translate(-10px, -10px) scale(1.1)"),E)||(await C(document.querySelector(".top-right"),"translate(5px, -5px)","translate(10px, -10px) scale(1.1)"),E)||(await C(document.querySelector(".bottom-left"),"translate(-5px, 5px)","translate(-10px, 10px) scale(1.1)"),E)||(await C(document.querySelector(".bottom-right"),"translate(5px, 5px)","translate(10px, 10px) scale(1.1)"),E));)await new Promise(function(t){setTimeout(t,500)})}function S(t,e){E=!0,t.style.display="block","circle-modal"===t.id&&document.querySelector(".main-container").classList.add("hidden"),e&&t.querySelector(".modal-content").classList.add(e),setTimeout(function(){t.classList.add("is-active"),history.pushState({modalId:t.id},"","#"+t.id)},10)}function T(e){var n;e.classList.contains("is-active")&&(e.classList.remove("is-active"),(n=e.querySelector(".modal-content")).addEventListener("transitionend",function t(){e.style.display="none",n.classList.remove("top-left-origin","top-right-origin","bottom-left-origin","bottom-right-origin"),n.removeEventListener("transitionend",t),document.querySelector(".modal.is-active")||(E=!1,B())}))}function z(){T(d),history.back()}p.addEventListener("click",function(){F||history.back()}),e.addEventListener("click",function(){history.back()}),window.addEventListener("keydown",function(t){"Escape"===t.key&&((t=document.querySelector(".modal.is-active"))&&"circle-modal"===t.id&&F||t&&history.back())}),window.addEventListener("popstate",function(t){var e=document.querySelector(".modal.is-active");if(e){if("circle-modal"===e.id&&F)return t.state&&e.id===t.state.modalId?void 0:void history.pushState({modalId:e.id},"","#"+e.id);t.state&&e.id===t.state.modalId||("name-modal"===e.id?(T(o),n.forEach(function(t){var e=t.dataset.quadrant;t.style.zIndex="1",t.style.opacity="1",t.style.transition="transform 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55), filter 0.4s ease","top-left"===e?t.style.transform="translate(-5px, -5px)":"top-right"===e?t.style.transform="translate(5px, -5px)":"bottom-left"===e?t.style.transform="translate(-5px, 5px)":"bottom-right"===e&&(t.style.transform="translate(5px, 5px)")})):"circle-modal"===e.id?function(){T(y);var e=y.querySelector(".modal-content");e.addEventListener("transitionend",function t(){f.innerHTML="",v.style.display="none",f.classList.add("hidden"),b.classList.add("hidden"),g.classList.add("hidden"),h.style.width="0%",w.classList.add("hidden"),m.style.display="block",document.querySelector(".main-container").classList.remove("hidden"),e.removeEventListener("transitionend",t)})}():"confirm-modal"===e.id&&z())}}),m.addEventListener("click",async function(){m.style.display="none",F=!0,v.style.display="block",f.classList.add("hidden"),b.classList.add("hidden"),p.classList.add("hidden"),S(y),I||await t,setTimeout(function(){function t(t){return t.map(function(t){return'<li class="new-quadrant-name">'+t.nombre+"</li>"}).join("")}var e,n,a,o;e=q["top-left"],n=q["top-right"],a=q["bottom-left"],o=q["bottom-right"],o=' <div class="new-circle-container"> <div class="new-circle"> <div class="new-quadrant top-left"> <ul class="new-quadrant-name-list">'+t(e)+'</ul> </div> <div class="new-quadrant top-right"> <ul class="new-quadrant-name-list">'+t(n)+'</ul> </div> <div class="new-quadrant bottom-left"> <ul class="new-quadrant-name-list">'+t(a)+'</ul> </div> <div class="new-quadrant bottom-right"> <ul class="new-quadrant-name-list">'+t(o)+"</ul> </div> </div> </div> ",f.innerHTML=o,f.classList.remove("hidden"),v.style.display="none",b.classList.remove("hidden"),p.classList.remove("hidden"),F=!1},2e3)});var D=!1;b.addEventListener("click",async function(){var t,e;D||(D=!0,b.classList.add("hidden"),g.classList.remove("hidden"),w.classList.remove("hidden"),t=0,e=setInterval(function(){t+=1,h.style.width=t+"%",95<=t&&clearInterval(e)},20),setTimeout(async function(){await async function(t){var e=q["top-left"],n=q["top-right"],a=q["bottom-left"],o=q["bottom-right"];function i(t,e){return t.map(function(t){return'<li style="font-size: 24px; line-height: 1.0; margin: 2px 0; font-weight: 300; color: '+e+';">'+t.nombre+"</li>"}).join("")}var s=document.createElement("div");s.style.width="600px",s.style.height="600px",s.style.borderRadius="50%",s.style.overflow="hidden",s.style.position="fixed",s.style.top="-9999px",s.style.backgroundColor=t,s.style.fontFamily="Poppins, sans-serif";var l="width: 50%; height: 50%; display: flex; justify-content: center; align-items: center; flex-direction: column; padding: 20px; box-sizing: border-box; text-align: center;",o=' <div style="display: flex; flex-wrap: wrap; width: 100%; height: 100%;"> <div style="'+l+' background-color: #5CA5BB;"> <ul style="list-style-type: none; padding: 0; margin: 0; color: #FFFFFF;">'+i(e,"#FFFFFF")+'</ul> </div> <div style="'+l+' background-color: #C94C69;"> <ul style="list-style-type: none; padding: 0; margin: 0; color: #FFFFFF;">'+i(n,"#FFFFFF")+'</ul> </div> <div style="'+l+' background-color: #D5D968;"> <ul style="list-style-type: none; padding: 0; margin: 0; color: '+("black"===t?"#FFFFFF":"#171717")+';">'+i(a,"black"===t?"#FFFFFF":"#171717")+'</ul> </div> <div style="'+l+' background-color: #63C963;"> <ul style="list-style-type: none; padding: 0; margin: 0; color: #FFFFFF;">'+i(o,"#FFFFFF")+"</ul> </div> </div> ";return s.innerHTML=o,document.body.appendChild(s),html2canvas(s,{scale:2,backgroundColor:t}).then(function(t){var e=document.createElement("a");e.download="cuadrantes.png",e.href=t.toDataURL("image/png"),e.click(),s.remove()})}("black"),clearInterval(e),h.style.width="100%",setTimeout(function(){g.classList.add("hidden"),w.classList.add("hidden"),b.classList.remove("hidden"),h.style.width="0%",D=!1},500)},2e3))});async function P(o){return new Promise(async function(t,e){var n=[];try{var a=window.collection(window.db,o),a=window.query(a,window.orderBy("timestamp","asc"));(await window.getDocs(a)).forEach(function(t){n.push({id:t.id,nombre:t.data().nombre})}),t(q[o]=n)}catch(t){console.error("Error al obtener los nombres: ",t),e(t)}})}n.forEach(function(a){a.addEventListener("click",async function(){var t=(x=a.getAttribute("data-quadrant"))+"-origin";E=!0,n.forEach(function(t){var e=t.dataset.quadrant,n="";"top-left"===e?n="translate(-200px, -250px) scale(3)":"top-right"===e?n="translate(200px, -250px) scale(3)":"bottom-left"===e?n="translate(-200px, 250px) scale(3)":"bottom-right"===e&&(n="translate(200px, 250px) scale(3)"),t===a?(t.style.transform=n,t.style.zIndex="10",t.style.opacity="1"):(t.style.transform="translate(0, 0) scale(1)",t.style.zIndex="1",t.style.opacity="0")}),l.innerHTML=k[x].title,await j(x),S(o,t)})}),i.addEventListener("input",function(){""!==i.value.trim()?a.classList.add("button-ready"):a.classList.remove("button-ready")}),a.addEventListener("click",async function(){var t=i.value.trim();t&&(await async function(t,e){try{var n=window.collection(window.db,t);await window.addDoc(n,{nombre:e,timestamp:new Date}),console.log("Nombre guardado en Firestore!")}catch(t){console.error("Error al guardar el nombre: ",t)}}(x,t),i.value="",await P(x),await j(x),a.classList.remove("button-ready"),a.classList.add("button-active-effect"),setTimeout(function(){a.classList.remove("button-active-effect")},1200))}),i.addEventListener("keydown",function(t){"Enter"===t.key&&a.click()}),c.addEventListener("click",async function(){null!==L.quadrant&&null!==L.docId&&(await async function(t,e){try{var n=window.doc(window.db,t,e);await window.deleteDoc(n),console.log("Nombre eliminado con éxito!")}catch(t){console.error("Error al eliminar el nombre: ",t)}}(L.quadrant,L.docId),await P(L.quadrant),await j(L.quadrant),z())}),r.addEventListener("click",function(){z()});async function j(a){s.innerHTML="";var t=q[a];t&&t.forEach(function(t){var e=document.createElement("li");e.textContent=t.nombre;var n=document.createElement("button");n.textContent="×",n.classList.add("delete-button"),n.addEventListener("click",function(){L.quadrant=a,L.docId=t.id,u.textContent=t.nombre,S(d)}),e.appendChild(n),s.appendChild(e)})}!async function(){await(t=Promise.all([P("top-left"),P("top-right"),P("bottom-left"),P("bottom-right")])),I=!0,console.log("Datos de cuadrantes precargados en la caché.")}(),B()});